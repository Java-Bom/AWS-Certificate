## AWS 글로벌 인프라

- 리전: AWS 서비스가 제공되는 지리적 위치

- 가용영역(AZ): 리전내에 복수개로 이루어진 데이터 센터
  - 리전이 없는 지역에는 로컬존이 존재한다.

- 상호접속위치(POP): 엣지로케이션 캐시 + 엣지로케이션
  - CDN과 같은 역할을 수행한다.
- AWS의 보안과 준수해야 할 원칙
  - 고객 책임
    - 클라우드 내의 보안
      - 고객 데이터
      - 플랫폼, 애플리케이션, 신분확인, 접근관리
      - 운영체제, 네트워크와 방화벽 설정
      - 클라이언트측 데이터 암호화 및 일관성 검증
      - 서버측 암호화
      - 네트워크 트래픽 보호
  - AWS 책임
    - 클라우드의 보안
      - 컴퓨트
      - 스토리지
      - 데이터베이스
      - 네트워킹
      - 리전
      - AZ
      - 엣지로케이션

## AWS 스토리지 서비스

- 객체 스토리지
  - 문서, 이미지, 비디오등에 메타데이터를 포함한 데이터
  - S3
- 블록 스토리지
  - 서버 인스턴스에 디스크 볼륨 형태로 제공되는 데이터
  - EBS
- 파일 스토리지
  - 서버 인스턴스에 파일 시스템 인터페이스, 시멘틱스 방식으로 제공되는 데이터
  - EFS

### S3 - 객체스토리지

- 저장 용량 무제한
- 파일시스템이 존재하지 않고 버킷이라는 네임스페이스로 동작
- 기본적으로 복수의 AZ 위에 다수의 LB, WS, 스토리지로 구성
  - 최소 3개의 AZ가 사용된다.
- 종국적 일관성을 제공한다.
  - 새 객체의 변경사항이 전파되기전 까지
    - 키 리스트에 출력되지 않는다.
    - 읽기 시도시 key does not exist 출력한다.
  - 기존 객체 대체시
    - 전파 전 까지 기존 데이터를 반환한다.
  - 기존 객체 삭제시
    - 전파 전까지 삭제 대상을 반환한다.
    - 삭제 대상도 키 리스트에 포함된다.
- 파티셔닝은 키의 전치사를 기준으로 이루어진다.
- 암호화는 두가지로 나뉜다.
  - 클라이언트
    - 전송 중인 데이터를 암호화
  - 서버
    - 저장 된 데이터를 암호화: SSE
      - AWS S3 키 매니지먼트 기반
        - 객체별 키를 통해 암호화한다. 객체별 키는 마스터키로 암호화 하고 S3 키 매니지먼트에 마스터 키를 관리한다. 마스터키는 월 단위로 변경된다.
      - 고객 자체 생성 키 기반
        - 고객이 자체 생성한 커스텀 암호화 키로 암-복호화한다. 커스텀 키는 S3에 저장하지 않는다.
      - AWS KMS 기반
        - 접근 통제를 위한 보안 레이어를 제공한다.
        - KMS 감사 기능으로 접근내역을 확인할 수 있다.
- 접근 제어
  - 방식
    - 접근 정책
      - IAM
    - 버킷 정책
      - 버킷 레벨에서  불특정 다수의 접근 허용
      - 특정 사용자에 대한 제한 가능
      - 허용-거절 사이더 설정이 가능하다.
    - 접근 제어 목록 (레거시)
      - ACL 활용
  - 베스트 프렉티스
    - MFA 설정으로 삭제를 제한
    - Trusted Advisor를 적용 버킷 접근 감사
    - IAM으로 접근 제어
- 스토리지 클래스
  - Standard: 기본형 스토리지
  - Standard IA: 접근 빈도가 낮은 데이터를 위한 스토리지
  - One Zone-IA: 접근 빈도가 낮지만 때에 따라 신속하게 접근 가능한 스토리지, 단일 AZ에만 저장
  - Intelligent-Tiering: 액세스 패턴에 따라 자동으로 다른 스토리지로 이동
  - Glacier: 데이터 장기보관용
  - Glacier Deep Archive: 데이터 장기보관용 복원하는데 최대 12시간
- 버저닝
  - 한번 활성화 하면 비활성화 불가능하지만 버저닝을 멈출 순 있다.
  - 이전 버전을 중요도가 낮은 스토리지 클래스로 이동 가능
- 라이프 사이클
  - 파일 이동
    - 다른 스토리지 클래스로 이동 할 수 있다.
  - 파일 소멸
- 복제 
  - 교차 리전 복제-CRR
    - 리전 to 리전 복제시 활성화 되어야 함
    - 비동기적 복제
    - 버저닝 기능 활성화 필수
    - Object lock 기능이 적용되었다면 둘다 적용되어 있어야 한다.
  - 동일 리전 복제-SRR
    - 데이터 레이크 용도
- S3 Glacier
  - 데이터 아카이빙
  - 수정이 불가능하다. 수정후 재업로드를 해야한다.
  - 단일 업로드 요청은 4GB
  - 볼트 삭제를 위해 볼트 내 데이터를 모두 삭제해야 한다.
  - 인덱스는 24시간 마다 갱신된다.
  - 업로드
    - Direct Connect로 온프레미스에서 바로 전송가능
    - Snowball을 이용해 큰 데이터 전송가능

### EBS

- EC2를 위한 영구 스토리지 기능
  - EC2 라이프 사이클에서 독립적
- 기본적으로 하나의 EBS 볼륨은 한번에 하나의 EC2에 부착할 수 있다.
  - 예외적으로 다중 연결 옵션으로 다수의 EC2에 동일한 볼륨 부착 가능
- 특정 시접 스냅샷을 지속적으로 저장 가능
  - S3에 저장하여 다중 AZ 자동 복제 기능 제공
  - 스냅샷 생성은 비동기적으로 이루어지기 때문에 쓰기 읽기 영향을 받지 않는다.
- 주요서비스
  - EC2 인스턴스 스토어
    - 인스턴스의 로컬 스토리지
    - 일시적이라 인스턴스 셧다운시 증발
    - 스냅샷 미제공
  - EBS SSD 기반볼륨
    - 범용 SSD gp2
      - 부트볼륨으로 사용가능
      - 가상 데스크톱
      - 처리 지연에 민감한 애플리케이션
    - 프로비전 IOPS SSD io1
      - IO성능이 중요(일관적인)한 워크로드
    - 부트볼륨으로 사용가능하다
  - EBS HDD 기반볼륨
    - 처리성능 최적화 HDD st1
      - 데이터 웨어하우스
      - ETL
      - 로그 프로세싱
      - 맵리듀스
    - 콜드 HDD sc1
      - 중요성이 높지않은 콜드 데이터 워크로드
    - 부트볼륨으로 사용 불가능하다.

### EFS

- EC2를 위한 파일 시스템 인터페이스
- EC2를 위한 파일 시스템 시맨틱 환경
- 공유 파일 시스템
  - 다수 인스턴스를 위한 공통 파일 시스템 역할 수행
- 간편성
  - NFS 프로토콜을 이용해 온프레미스에도 부착가능
- 탄력성 제공
  - 프로비저닝 필요 없음
- 사용량에 따른 비용 지불
- 온프레미스와 통합하기
  - Storage GateWay
    - 기존환경에 가상머신 형태로 배포
    - 게이트웨이를 연결해 데이터를 S3, S3 Glacier로 저장 가능
  - 종류
    - 파일 게이트웨이
      - 파일 프로토콜 이용
      - NFS 파일공유 지원
    - 볼륨 게이트웨이
      - 블록 프로토콜 기반 디스크 볼륨 제공
      - 비동기적 스냅샷 백업
      - 모드
        - 캐시드 모드
          - 자주 사용되는건 로컬에 저장
        - 스토어드 모드
          - 전체 로컬에 저장
          - 비동기적으로 S3 백업
    - 테이프 게이트웨이
      - 가상 테이프 라이브러리
      - 무한의 확장성
- Snowball
  - 페타바이트규모 데이터 이전
  - 10Gbps의 네트워크 인터페이스로 80TB까지 복제 이송 가능
  - 이송전 256-bit GSM으로 암호화 필수
  - Snowball Edge
    - 100TB까지 복제 가능
- Snowbmobile
  - 엑사바이트 규모의 데이터 이전
  - 탈부착 가능한 고속 네트워크를 로컬 네트워크와 연결
