### 9장 AWS WAF

- WAF의 장점
  - 신속한 개발과 배포
    - 시스템 운영과 관련된 위험 관리 업무는 줄어들고, 업무의 자동화 및 적재적소에 맞는 용량관리를 통해 클라우드의 효용성을 증대시킬 수 있음
  - 위험의 감소
    - 아키텍처에 존재하는 위험을 파악하고 비지니스에 미칠 부정적인 영향을 최소화한다
  - 정보 기반의 의사결정
    - 능동적인 아키텍처 구현을 위한 의사결정을 내릴 수 있다
  - 최선의 AWS 활용 전략
    - 다수의 기업 및 사용자에 의해 검증된 최선의 AWS 활용 전략을 팀 및 조직에 적용할 수 있다
- AWS WAF 다섯가지 원칙
  - 운영 우수성 원칙
    - 운영 업무의 코드화 
      - 전체 인프라를 코드로 표현 가능
      - 예시 - auto scaling을 통해 자동으로 새 서버 실행
    - 운영 업무의 문서화
      - 모든 운영 업무를 문서화한다
    - 지속적인 작은 변화의 실천
      - 시스템에 한번에 큰 변화를 주기보다 시스템을 개선할 수 있는 수정 가능한 작은 변화를 지속적으로 추구
    - 운영 절차의 지속적 개선
      - 정기적으로 운영 절차를 검토 및 검증해야 한다.
    - 실패 상황 고려
      - 실패 시나리오를 시뮬레이션해 발생 가능한 장애 상황 대비
    - 운영 실패 사례를 통한 학습
      - 운영 팀은 항상 운영 실패 사례에서 교훈을 얻고 동일한 실패 상황이 재발하지 않도록 해야 한다.
    - 운영의 우수성을 확보하기 위한 세가지 주요 영역
      - 준비
        - 요구 성능 기준선을 설정 이에 맞춰 지원 업무 제공
        - 예기치 못한 다운 타임에 대응
      - 운영
        - 비지니스 유닛과의 적절한 커뮤니케이션 상태를 유지
        - 운영 팀의 대시보드에 필요한 네가지 대시보드
          - Amazon CloudWatch logs - aws 리소스의 로그를 모니터링 저장
          - Amazon ES - 로그 분석, 애플리케이션 모니터링을 위한 es 
          - Persnal Health Dashboard - 사용자 개인에게 영향을 미칠 수 있는 이벤트에 대한 경고
          - Service Health Dashboard - AWS 서비스의 가용성과 관련된 주요 정보
      - 발전
        - 인프라 관리에 적용되는 베스트 프랙티스를 통해 지속적인 발전 도모
  - 보안성 원칙
    - 강력한 접근 관리 전략 수립
      - iam을 활용한 최소 권한 부여
      - aws odemtoty federation은 saml 2.0 또는 웹 신분 증명을 통해 사용할 수 있으며, 구글 페이스북 등 다른 기관에서 발급한 ID를 Iam의 신분 및 권한 증명에 사용 가능
      - 하나의 서비스에서 다른 서비스로 이동 시 IAM 롤의 실용성이 낮아지므로 AWS sts 활용
      - 유저네임 및 패스워드 방법 대신 액세스 키 및 시크릿 키 방법으로 신분 또는 권한 증명 가능
    - 추적 기능 활용
      - 시스템에서 일어나는 모든일을 추적,감사,모니터링 할 수 있다
      - AWS Config를 이용해 AWS 리소스 인벤토리, 환경 설정 내역의 추적을 및 거버넌스를 위한 환경 설정 변경 알림 업무를 수행할 수 있다
      - cloudTrail을 이용한 주요 활동 정보 수집
      - CloudWatch 로그에 전송해 컴퓨트 스토리지 애플리케이션에서 발생한 주요 활동 정보 파악
    - 모든 레이어에 대한 보안
      - 리소스의 전 스텍에 걸처 적용해야함 
        - 웹티어,앱티어,데이터 배이스 티어 티어별 접근 권한 부여
        - 퍼블릭 서브넷,프라이빗 서브넥
    - 데이터 보안
      - 전송 상태 데이터 암호하 
        - Vpn/Direct Connect/SSL/TLS로 암호화 가능
      - 대기 상태 데이터
        - TDE 기술을 활용해 데이터를 암호화
      - S3 서버측 암호화 및 EBS 볼륨 암호화 기능을 사용 할 수 있다
      - Aws cf 는 SSL 인증서 , SNI 기반 커스텀 SSL, 전용 IP 커스텀 SSL 기능 제공
    - 보안 자동화
      - 보안 팀은 경고 메시지 수신 즉시 자동으로 보안 위협에 대응하는 체계를 가춰야함
      - 위협 가능성을 항상 확인하기 위한 모니터링 및 로그 리포트 체계를 갖춘다
    - 보안 위협에 대한 대응
      - 보안 위협 이벤트에 미리 대비한다
      - 보안 위협 이벤트를 재현해 미리 학습
    - 보안성 원칙의 베스트 프랙티스
      - IAM 활용
      - 탐지 제어 서비스 활용
        - 시스템에 대한 침해 시도 또는 위협을 탐지하기 위해 탐지 제어 기능 활용
        - 로그 수집 및 분석
        - AWS Config
          - 리소스 인벤토리, 환경 설정에 대한 시간 순 기록, 보안 및 거버넌스를 위한 환경 설정 변경 노티피케이션 등을 활용하여 보안 규정 감사, 보안 체계 분석
        - AWS Config rule
          - 리소스 환경 설정 규칙으로 AWS Config에 기록되는 리소스 환경 설정 변경의 적절성을 평가하는 기준이 된다
          - 평가 결과 대시보드 노출
        - AWS CloudTrail
          - 사용자의 계정에 대한 AWS API의 호출 기록 및 로그 관리를 위한 서비스
        - Amazon CloudWatch
          - 애플리케이션 성능, 운영 건전성 등의 성능 지표를 시각화해 제공한다
        - Vpc flow logs
          - vpc, vpc 서브넷 또는 ENI 접속과 관련된 모든 네트워크 트래픽은 CloudWatch logs에 기록된다
        - Amazon Inspector
          - 보안상의 약점, 애플리케이션 및 운영 시스템의 잘못된 환경 설정 등을 프로그래밍 방식으로 찾을 수 있는 도구
      - 인프라 보호 기능 활용
        - 잠재적 침해 행위로부터 시스템과 서비스를 보호
        - 서브넷,VPC,라이팅 테이블,NACL,게이트웨이,시큐리티 그룹
        - AWS Systems Manager를 이용해 시스템 보안환경 설정 및 유지보수
      - 데이터 보호 기능 활용
        - 데이터 타입에 따라 적절한 데이터 분류 방식을 정하고 접근 및 보호 수준을 결정할 수 있다.
        - 적절한 기준에 따라 데이터 분류한 뒤에는 데이터를 암호화하거나 토큰화할 수 있음
          - 민감정보 토큰 대체
      - 침해 대응 기능 활용
        - 침해 사고 예방 연습 수행
        - WAF,shield를 활용
  - 성능 원칙
    - 성능은 결국 속도에 대한 것이며 성능 효율성을 통해 비즈니스 성과를 향상시키는 것이 목표
    - 간단한 조작으로 글로벌화 달성 - 멀티 AZ 활용
    - 서버리스 등 신기술 활용 - 인프라 관리가 필요 없는 서버리스 아키텍처를 활용
    - 최신의 고급 기술 활용 - 온프레미스 환경을 클라우드로 쉽게 이관할 수 있는 도구 제공
    - 다수의 기술 활용
    - 잦은 실험과 혁신 노력
  - 신뢰성 원칙
    - 복원 절차 검증
      - 발상할 수 있는 실패상황을 시뮬레이션하고 실패 상황을 어떻게 극복할 수 있는지 검증
    - 실패 복원의 자동화
    - 리소스의 수평적 확장
      - 수평적 확장을 통한 위험 부담 최소화
    - 요구 성능 및 용량 구체화
      - 적정 용량 계획이라는 개념 필요 없음
      - 사용량 증가에 대한 경고 발생 시 새로운 리소스를 추가하는 과정만 자동화한다
    - 시스템 변경 업무의 자동화
      - 오류 가능성 최소화를 위한 자동화
    - 신뢰성 원칙의 베스트 프랙티스
      - 신뢰의 토대 구축
        - 장애 격리 지연 활용 - 다중 AZ 활용
        - 중복 구현 요소 활용 - 데이터의 이중보호/RAID
        - 관리형 서비스 활용 - AWS 관리형 서비스 - RDS
      - 변경 대응 관리
        - 블루 그린 배포
          - 두 개의 배포 스택이 병렬적으로 실행
          - 신 버전 스택에 약간의 트래픽만을 흘려 보내 실패,오류 가능성 파악 후 배포진행
        - 카나리아 배포
          - 고객 중 일 부를 새 버전으로 라우팅해 변경 또는 오류 가능성을 검증 후 배포
        - 기능별 활성화
          - 고객이 필요 기능으로 인지하지 못하는 기능을 비활성화한 채로 배포하는 방식
          - 배포판 검증 후 해당 기능 활성화
  - 비용 최적화 원칙
    - 최적의 소비 모델 선택
      - 온디맨드/스팟 등 요구사항에 맞는 모델 선택
    - 관리형 서비스 사용
    - 전반적인 효율성 측정
    - 비용 분석
    - 전통적인 데이터 센터 투자 감축
  - AWS 베스트 프랙티스
    - 클라우드로 이전
    - 클라우드 최적화
      - 관리형 서비스 사용등의 클라우드 서비스의 강점을 활용
    - 클라우드 네이트브 아키텍처
      - 아키텍처 설계의 시작부터 클라우드를 염두에 두고 진행하는 방법으로 모든 AWS 서비스를 활용
    - 실패 대응 설계
      - 멀티 AZ 활용
      - ELB 활용
      - EIP 활용
      - cloudWatch를 이용한 모니터링
      - CloudWatch 지표에 따른 실시간 경보를 위해 SNS 활용
      - 멀티 AZ 환경에 스탠바이 데이터베이스 추가 생성
    - 모든 레이어에 보안성 구현
    - 다중 스토리지 옵션의 활용
      - 상황에 맞는 스토리지 옵션 사용 - rds에 저장된 데이터의 결과를 elasticCache에 저장
    - 클라우드 리소스의 탄력성 구현
      - ASG - 기업의 IT 환경에 EC2 인스턴스를 추가 또는 제거해 인프라를 자동으로 확장할 수 있도록 도움
      - ELB - 멀티 AZ 환경에서 기업의 워크로드를 Ec2 인스턴스에 분산 배치
      - DynamoDB - 세션 등 사용자의 상태 정보관리에 유용한 nosql 데이터베이스
    - 병렬 처리 기법의 활용
      - 멀티 스레드 및 동시 병행처리 활용
      - 맵리듀스 잡 활용
        - Amazon EMR 
        - 하나의 프로세싱 잡에 포함된 데이터를 작은 덩어리로 나눠 병렬적으로 처리하고 병합
      - ELB를 이용한 워크로드 배포
      - Kinesis를 이용한 데이터 동시병행 처리
        - 다수의 애플리케이션에서 들어오는. 데이터 스트림을 동시 병행적으로 처리
    - 느슨하게 연결된 아키텍쳐
      - 클라우드 아키텍처 설계 시 각 요소가 독립적으로 작동할 수 있도록 해야함
      - 각 요소를 느슨하게 연결할수록 아키텍처의 확장성을 높일 수 있다