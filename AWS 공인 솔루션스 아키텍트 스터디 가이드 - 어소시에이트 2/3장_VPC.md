#### 3장 VPC



- Amazon Vpc

  - 클라우드 내 프라이빗 공간
  - vpc 생성 첫번째 단계는 cidr 블록 범위 설정
    - ipv4는 최소 28 - 최대 16
    - ipv6는 56 고정
  - vpc는 리전에 제한된다
  - Vpc 내에서 동일 리전의 az 포함 가능

- 서브넷

  - Ip 네트워크의 논리적인 하위 부분을 가리킨다
  - 서브넷을 통해 하나의 네트워크를 여러 개로 나눌 수 있다
    - 프라이빗 서브넷, 퍼블릿 서브넷, vpn 온리 서브넷
  - Cidr 블록을 이용해 서브넷을 정의할 수 있다
  - 여러개의 az에 연결되는 서브넷은 만들 수 없다
    - az마다 생성
  - 서브넷 중 처음 네 개의 ip 주소와 마지막 ip 주소는 인터넷 네트워킹을 위한 예약 주소

- 라우트 테이블

  - 트래픽 전송 방향을 결정하는 라우트와 관련된 규칙을 담은 테이블
  - 모든 서브넷은 라우트 테이블을 지닌다
  - 하나의 라우트 테이블을 여러 서브넷에 연결가능하다
  - 서브넷 생성 후 라우트 테이블을 연결하지 않으면 자동으로 메인 라우트 테이블을 연결한다

- 인터넷 게이트웨이

  - vpc가 인터넷으로 연결되도록 하는 요소
  - vpc 라우트 테이블에 ig와 관련된 내용이 없다면 어떤 서브넷에서도 인터넷으로 연결될 수 없다
  - vpc에 ig를 붙이면 라우트 테이블에 정의된 ig를 통해 서브넷에서 인터넷으로 연결 가능하다

- nat

  - 인터넷 접속 불능으로 설정된 프라이빗 서브넷에 있는 서버 인스턴스를 인터넷에 연결할 수 있다
  - Nat 인스턴스
    - 프라이빗 서브넷에서 인터넷 또는 다른 aws로 트래픽을 보낼 수 있다
    - 퍼블릭 서브넷에 구현
    - 단일 실패 지점을 방지하기 위해 nat 인스턴스를 중복 구현하거나 서로 다른 az에서 액티브/패시브 모드로 실행
    - Eip 필요
  - nat 게이트웨이
    - Nat 인스턴스보다 가용성 및 네트워크 대역이 높다
    - eip 필요

- 외부 전용 인터넷 게이트웨이

  - 외부 전용 인터넷 게이트웨이는 nat 게이트웨이와 비슷한 기능 수행
  - ipv6 기반 인터넷 트래픽 이동 담당

- 탄력적 네트워크 인터페이스

  - 하나 혹은 다수의 네트워크 인터페이스를 생성 인스턴스에 붙이는 역할을 담당
  - 특정 인스턴스를 가리키던 네트워크 인터페이스를 다른 인스턴스로 이동시키면 네트워크 트래픽은 새로운 신스턴스를 가리키게된다
  - 인스턴스 타입별로 네트워크 인터페이스를 여러개 부착할 수 있지만 인스턴스로 향하는 네트워크 대역폭 또는 전송용량에는 영향을 주지 않는다

- Linux에서 향상된 네트워킹

  - Ena
    - 지원 인스턴스 타입에 따라 최대 100gbps의 네트워크를 지원한다
  - vf
    - 인터페이스를 사용하는 경우 vfsms wldnjs dlstmxjstm xkdlqdp Ekfk chleo 10휴ㅔㄴdml spxmdnjzmfmf wldnjs

- eip

  - 정적 ip 주소
  - Ec2 정지해도 고정 ip로 사용가능

- 네트워크 보안

  - 시큐리티 그룹
    - 가상 방화벽과 같다
    - 내부 또는 외부로 이동하는 트래픽 정의
    - 인스턴스 별 최대 5개 부여가능
  - 네트워크 액세스 제어 목록
    - Vpc 서브넷 레벨에 적용할 수 있는 추가 방화벽
    - Ipv4,ipv6 인바운드/아웃바운드 트래픽 필터링
    - 시큐리티 그룹은 인스턴스 레벨에 적용되고 nacl은 서브넷 레벨에 적용

- vpc 피어링

  - 하나의 vpc를 또 다른 vpc 연결
  - vpc a - vpc b - vpc c 피어링 되어있을때 b를통해 a와 c가 연동되진 않는다

- vpc 엔드포인트

  - 리전별 서비스인 s3등은 vpc 외부에서 실핸된다 vpc와 연결하려면 엔드포인트가 필요하다
  - privateLink를 사용한다
  - privateLink로 연결된 aws 서비스는 direct Connect를 이용해 기업데이터 센터와 연결할 수 있다
  - 인터페이스 엔드포인트/게이트웨이 엔드포인트 두가지 유형이 존재
  - vpc엔드포인트를 이용할 시 별도의 전송 요금 발생 x

- transit gateway

  - 네트워크 전송 허브를 이용해 vpc와 온프레미스 네트워크를 연결할 수 있다
  - 멀티 vpc 피어링 환경에 대한 관리부담을 줄일 수 있다

- DNS와 VPC

  - 도메임 네임 디렉터리를 관리하고 이를 IP 주소로 바꾸는 기능을 수행한다
  - Dns 서버는 vpc 내에서 실행중인 모든 인스턴스의 주소를 관리한다

- DHCP 옵션 세트

  - 기본 도메인 네임, DNS 서버 등 VPC에 있는 인스턴스의 호스트 환결 설정에 사용된다
  - dhcp에 설정한 도메임 네임을 통해 특정 도메인 또는 dns를 가리킬 수 있다

- 기업의 데이터 센터와 연결방법

  - 버추얼 프라이빗 게이트웨이
    - vpc에 장착 후 커스텀 라이트 테이블을 연결
  - 커스토머 게이트웨이
    - 데이터 센터 측 또는 vpn 연결 부분에 있는 물리적 디바이스에 장착
  - aws 하드웨어 vpn
    - vpc와 리모트 네트워크를 연결하기 위해 하드웨어 vpn 연결인 ipsec을 생성할 수 있다
  - Aws dc
    - 전용선
    - 일관된 성능 보장
  - vpn cloudHub
    - 하나 이상의 원격 네트워크가 있다면 vpc를 통해 여러개의 aws hardware vpn 연결하고 cloudHub를 이용하면 여러개의 사이트에서 vpn에 접근할 수 있고, 허브 앤 스포크 모델을 통해 보안성을 높여준다

- software vpn

  - vpn 장비가 부착된 vpc내의 ec2 인스턴스를 이용해 원격 네트워크로 연결되는 vpn 연결을 생성한다

- vpc 흐름 로그

  - vpc 내 ip트래픽에 대한 정보를 확인할 수 있다

  

  

  

  

  

  

